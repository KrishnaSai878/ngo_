{% extends "admin/base.html" %}

{% block page_title %}Settings - Admin{% endblock %}

{% block admin_content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="fas fa-cog"></i> System Settings</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item active">Settings</li>
                </ol>
            </nav>
        </div>
    </div>

    <form method="POST" action="{{ url_for('update_admin_settings') }}">
        <!-- General Settings -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-globe"></i> General Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="site_name" class="form-label">Site Name</label>
                                    <input type="text" class="form-control" id="site_name" name="site_name" 
                                           value="{{ settings.site_name }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="site_email" class="form-label">Site Email</label>
                                    <input type="email" class="form-control" id="site_email" name="site_email" 
                                           value="{{ settings.site_email }}" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="maintenance_mode" 
                                               name="maintenance_mode" {% if settings.maintenance_mode %}checked{% endif %}>
                                        <label class="form-check-label" for="maintenance_mode">
                                            Maintenance Mode
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="registration_enabled" 
                                               name="registration_enabled" {% if settings.registration_enabled %}checked{% endif %}>
                                        <label class="form-check-label" for="registration_enabled">
                                            Registration Enabled
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_verification_required" 
                                               name="email_verification_required" {% if settings.email_verification_required %}checked{% endif %}>
                                        <label class="form-check-label" for="email_verification_required">
                                            Email Verification Required
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Settings -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-shield-alt"></i> Security Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="max_login_attempts" class="form-label">Max Login Attempts</label>
                                    <input type="number" class="form-control" id="max_login_attempts" 
                                           name="max_login_attempts" value="{{ settings.max_login_attempts }}" min="3" max="10">
                                    <div class="form-text">Number of failed login attempts before account lockout</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="session_timeout" class="form-label">Session Timeout (seconds)</label>
                                    <input type="number" class="form-control" id="session_timeout" 
                                           name="session_timeout" value="{{ settings.session_timeout }}" min="1800" max="86400">
                                    <div class="form-text">Time in seconds before automatic logout (30 min - 24 hours)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Upload Settings -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-upload"></i> File Upload Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="file_upload_max_size" class="form-label">Max File Size (MB)</label>
                                    <input type="number" class="form-control" id="file_upload_max_size" 
                                           value="{{ settings.file_upload_max_size // (1024 * 1024) }}" readonly>
                                    <div class="form-text">Maximum allowed file size for uploads</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="allowed_file_types" class="form-label">Allowed File Types</label>
                                    <input type="text" class="form-control" id="allowed_file_types" 
                                           value="{{ settings.allowed_file_types|join(', ') }}" readonly>
                                    <div class="form-text">Comma-separated list of allowed file extensions</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between">
                    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                    <button type="submit" class="btn btn-primary" onclick="return confirmCriticalSettings()">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// Add confirmation for critical settings
function confirmCriticalSettings() {
    const maintenanceMode = document.getElementById('maintenance_mode').checked;
    const registrationEnabled = document.getElementById('registration_enabled').checked;
    
    let message = 'Are you sure you want to save these settings?';
    
    if (maintenanceMode) {
        message += '\n\n⚠️ WARNING: Enabling maintenance mode will make the site unavailable to users!';
    }
    
    if (!registrationEnabled) {
        message += '\n\n⚠️ WARNING: Disabling registration will prevent new users from signing up!';
    }
    
    return confirm(message);
}

// Add form submission handler
document.querySelector('form').addEventListener('submit', function(e) {
    if (!confirmCriticalSettings()) {
        e.preventDefault();
        return false;
    }
});
</script>
{% endblock %}
